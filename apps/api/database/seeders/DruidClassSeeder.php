<?php

namespace Database\Seeders;

use App\Models\CharacterClass;
use App\Models\Setting;
use Illuminate\Database\Seeder;

class DruidClassSeeder extends Seeder
{
    public function run(): void
    {
        $eberron = Setting::where('slug', 'eberron')->first();
        $forgottenRealms = Setting::where('slug', 'forgotten-realms')->first();

        // Update base druid class with complete data
        $druid = CharacterClass::updateOrCreate(
            ['slug' => 'druid'],
            $this->getDruidClass()
        );

        // Attach to settings
        if ($eberron) {
            $druid->settings()->syncWithoutDetaching([$eberron->id]);
        }
        if ($forgottenRealms) {
            $druid->settings()->syncWithoutDetaching([$forgottenRealms->id]);
        }

        // Seed subclasses
        $subclasses = $this->getSubclasses();
        foreach ($subclasses as $data) {
            $subclass = CharacterClass::updateOrCreate(
                ['slug' => $data['slug']],
                array_merge($data, [
                    'hit_die' => 'd8',
                    'is_spellcaster' => true,
                    'spellcasting_ability' => 'wisdom',
                    'is_system' => true,
                ])
            );

            if ($eberron) {
                $subclass->settings()->syncWithoutDetaching([$eberron->id]);
            }
            if ($forgottenRealms) {
                $subclass->settings()->syncWithoutDetaching([$forgottenRealms->id]);
            }
        }

        $this->command->info('Druid class seeded: base class + ' . count($subclasses) . ' circles');
    }

    private function getDruidClass(): array
    {
        return [
            'slug' => 'druid',
            'name' => ['ru' => 'Друид'],
            'description' => ['ru' => 'Хранитель Старой Веры, облечённый силами природы — луны, Земли и огня, ветра и молнии. Друиды способны принимать облик животных и повелевать стихиями.'],
            'hit_die' => 'd8',
            'primary_abilities' => ['wisdom'],
            'saving_throws' => ['intelligence', 'wisdom'],
            'armor_proficiencies' => ['light', 'medium', 'shields'],
            'weapon_proficiencies' => ['club', 'dagger', 'dart', 'javelin', 'mace', 'quarterstaff', 'scimitar', 'sickle', 'sling', 'spear'],
            'tool_proficiencies' => ['herbalism_kit'],
            'skill_choices' => 2,
            'skill_options' => ['arcana', 'animal_handling', 'insight', 'medicine', 'nature', 'perception', 'religion', 'survival'],
            'starting_equipment' => [
                ['choice' => true, 'options' => [
                    [['item' => 'wooden_shield', 'qty' => 1]],
                    [['item' => 'simple_weapon', 'qty' => 1]],
                ]],
                ['choice' => true, 'options' => [
                    [['item' => 'scimitar', 'qty' => 1]],
                    [['item' => 'simple_melee_weapon', 'qty' => 1]],
                ]],
                ['item' => 'leather_armor', 'qty' => 1],
                ['item' => 'explorer_pack', 'qty' => 1],
                ['item' => 'druidic_focus', 'qty' => 1],
            ],
            'starting_gold_formula' => '2d4 * 10',
            'level_features' => [
                '1' => [
                    ['key' => 'druidic', 'name' => 'Друидический язык', 'description' => 'Вы знаете друидический язык — тайный язык друидов. Вы можете говорить на нём и использовать его для оставления скрытых посланий. Другие друиды автоматически понимают такие послания.', 'type' => 'feature'],
                    ['key' => 'spellcasting', 'name' => 'Использование заклинаний', 'description' => 'Черпая божественную сущность самой природы, вы можете творить заклинания друида. Мудрость — ваша базовая характеристика для заклинаний. Вы готовите список заклинаний после каждого продолжительного отдыха.', 'type' => 'spellcasting'],
                ],
                '2' => [
                    ['key' => 'wild_shape', 'name' => 'Дикий облик', 'description' => 'Действием вы можете магически принять облик зверя, которого вы видели. Вы можете использовать эту способность дважды между отдыхами. На 2 уровне вы можете превращаться в зверей с ОП 1/4 и без скорости полёта и плавания.', 'type' => 'feature', 'uses' => 2, 'recharge' => 'short_rest'],
                    ['key' => 'druid_circle', 'name' => 'Круг друидов', 'description' => 'Выберите круг друидов, определяющий вашу связь с природой.', 'type' => 'subclass'],
                ],
                '4' => [
                    ['key' => 'ability_score_improvement', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                    ['key' => 'wild_shape_improvement_4', 'name' => 'Улучшение дикого облика', 'description' => 'Вы можете превращаться в зверей с ОП 1/2 или ниже без скорости полёта.', 'type' => 'improvement'],
                ],
                '8' => [
                    ['key' => 'ability_score_improvement_8', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                    ['key' => 'wild_shape_improvement_8', 'name' => 'Улучшение дикого облика', 'description' => 'Вы можете превращаться в зверей с ОП 1 или ниже.', 'type' => 'improvement'],
                ],
                '12' => [
                    ['key' => 'ability_score_improvement_12', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                ],
                '16' => [
                    ['key' => 'ability_score_improvement_16', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                ],
                '18' => [
                    ['key' => 'timeless_body', 'name' => 'Безвременное тело', 'description' => 'Первозданная магия замедляет ваше старение. За каждые 10 лет ваше тело стареет только на 1 год.', 'type' => 'feature'],
                    ['key' => 'beast_spells', 'name' => 'Заклинания зверя', 'description' => 'Вы можете творить заклинания друида в диком облике. Вы можете выполнять соматический и вербальный компоненты, но не можете использовать материальные компоненты.', 'type' => 'feature'],
                ],
                '19' => [
                    ['key' => 'ability_score_improvement_19', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                ],
                '20' => [
                    ['key' => 'archdruid', 'name' => 'Архидруид', 'description' => 'Вы можете использовать Дикий облик неограниченное количество раз. Кроме того, вы можете игнорировать соматический и вербальный компоненты заклинаний друида, а также материальные компоненты без указанной цены.', 'type' => 'feature'],
                ],
            ],
            'progression' => [
                '1' => ['proficiency_bonus' => 2, 'cantrips' => 2, 'wild_shape_max_cr' => 0],
                '2' => ['proficiency_bonus' => 2, 'cantrips' => 2, 'wild_shape_max_cr' => 0.25],
                '3' => ['proficiency_bonus' => 2, 'cantrips' => 2, 'wild_shape_max_cr' => 0.25],
                '4' => ['proficiency_bonus' => 2, 'cantrips' => 3, 'wild_shape_max_cr' => 0.5],
                '5' => ['proficiency_bonus' => 3, 'cantrips' => 3, 'wild_shape_max_cr' => 0.5],
                '6' => ['proficiency_bonus' => 3, 'cantrips' => 3, 'wild_shape_max_cr' => 0.5],
                '7' => ['proficiency_bonus' => 3, 'cantrips' => 3, 'wild_shape_max_cr' => 0.5],
                '8' => ['proficiency_bonus' => 3, 'cantrips' => 3, 'wild_shape_max_cr' => 1],
                '9' => ['proficiency_bonus' => 4, 'cantrips' => 3, 'wild_shape_max_cr' => 1],
                '10' => ['proficiency_bonus' => 4, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '11' => ['proficiency_bonus' => 4, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '12' => ['proficiency_bonus' => 4, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '13' => ['proficiency_bonus' => 5, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '14' => ['proficiency_bonus' => 5, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '15' => ['proficiency_bonus' => 5, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '16' => ['proficiency_bonus' => 5, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '17' => ['proficiency_bonus' => 6, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '18' => ['proficiency_bonus' => 6, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '19' => ['proficiency_bonus' => 6, 'cantrips' => 4, 'wild_shape_max_cr' => 1],
                '20' => ['proficiency_bonus' => 6, 'cantrips' => 4, 'wild_shape_max_cr' => 'unlimited'],
            ],
            'is_spellcaster' => true,
            'spellcasting_ability' => 'wisdom',
            'spell_slots' => [
                '1' => ['1st' => 2],
                '2' => ['1st' => 3],
                '3' => ['1st' => 4, '2nd' => 2],
                '4' => ['1st' => 4, '2nd' => 3],
                '5' => ['1st' => 4, '2nd' => 3, '3rd' => 2],
                '6' => ['1st' => 4, '2nd' => 3, '3rd' => 3],
                '7' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 1],
                '8' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 2],
                '9' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 1],
                '10' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 2],
                '11' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 2, '6th' => 1],
                '12' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 2, '6th' => 1],
                '13' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 2, '6th' => 1, '7th' => 1],
                '14' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 2, '6th' => 1, '7th' => 1],
                '15' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 2, '6th' => 1, '7th' => 1, '8th' => 1],
                '16' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 2, '6th' => 1, '7th' => 1, '8th' => 1],
                '17' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 2, '6th' => 1, '7th' => 1, '8th' => 1, '9th' => 1],
                '18' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 3, '6th' => 1, '7th' => 1, '8th' => 1, '9th' => 1],
                '19' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 3, '6th' => 2, '7th' => 1, '8th' => 1, '9th' => 1],
                '20' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 3, '5th' => 3, '6th' => 2, '7th' => 2, '8th' => 1, '9th' => 1],
            ],
            'subclass_level' => '2',
            'subclass_name' => ['ru' => 'Круг друидов'],
            'is_system' => true,
            'sort_order' => 4,
        ];
    }

    private function getSubclasses(): array
    {
        return [
            // CIRCLE OF THE LAND
            [
                'slug' => 'circle-of-the-land',
                'name' => ['ru' => 'Круг Земли'],
                'parent_slug' => 'druid',
                'description' => ['ru' => 'Круг Земли состоит из мистиков и мудрецов, хранящих древние знания и обряды. Их магия находится под влиянием земли, на которой они были посвящены.'],
                'level_features' => [
                    '2' => [
                        ['key' => 'bonus_cantrip', 'name' => 'Дополнительный заговор', 'description' => 'Вы узнаёте один дополнительный заговор друида на ваш выбор.', 'type' => 'choice'],
                        ['key' => 'natural_recovery', 'name' => 'Естественное восстановление', 'description' => 'Во время короткого отдыха вы можете восстановить часть магических сил. Выберите потраченные ячейки заклинаний, сумма уровней которых не превышает половину вашего уровня друида (округляя в большую сторону). Вы не можете восстановить ячейки 6 уровня и выше. Использовать можно один раз за продолжительный отдых.', 'uses_per_rest' => 1, 'recharge' => 'long_rest'],
                    ],
                    '3' => [
                        ['key' => 'circle_spells', 'name' => 'Заклинания круга', 'description' => 'Ваша связь с землёй даёт вам доступ к определённым заклинаниям. Выберите тип местности: арктика, побережье, пустыня, лес, луг, гора, болото или Подземье. Заклинания круга всегда подготовлены и не учитываются в количестве подготовленных заклинаний.', 'type' => 'choice'],
                    ],
                    '6' => [
                        ['key' => 'lands_stride', 'name' => 'Путь по земле', 'description' => 'Перемещение по немагической труднопроходимой местности не требует дополнительного перемещения. Вы также можете проходить сквозь немагические растения без замедления и без получения урона от шипов. Вы получаете преимущество на спасброски от магически созданных или управляемых растений.'],
                    ],
                    '10' => [
                        ['key' => 'natures_ward', 'name' => 'Защита природы', 'description' => 'Вы не можете быть очарованы или испуганы элементалями или фей, и вы получаете иммунитет к яду и болезням.'],
                    ],
                    '14' => [
                        ['key' => 'natures_sanctuary', 'name' => 'Святилище природы', 'description' => 'Существа природного мира чувствуют вашу связь с природой и не решаются атаковать вас. Когда зверь или растение атакует вас, оно должно совершить спасбросок Мудрости против СЛ ваших заклинаний друида. При провале оно должно выбрать другую цель или отменить атаку. При успехе существо получает иммунитет к этому эффекту на 24 часа.'],
                    ],
                ],
            ],

            // CIRCLE OF THE MOON
            [
                'slug' => 'circle-of-the-moon',
                'name' => ['ru' => 'Круг Луны'],
                'parent_slug' => 'druid',
                'description' => ['ru' => 'Друиды Круга Луны — непреклонные хранители дикой природы. Они обладают способностью превращаться в более могущественных зверей и используют эту способность в бою.'],
                'level_features' => [
                    '2' => [
                        ['key' => 'combat_wild_shape', 'name' => 'Боевой дикий облик', 'description' => 'Вы можете использовать Дикий облик бонусным действием вместо действия. Кроме того, находясь в диком облике, вы можете бонусным действием потратить одну ячейку заклинаний, чтобы восстановить 1d8 хитов за каждый уровень потраченной ячейки.'],
                        ['key' => 'circle_forms', 'name' => 'Формы круга', 'description' => 'Вы можете превращаться в зверей с ОП 1 (без ограничений на способ перемещения). Начиная с 6 уровня, максимальный ОП равен уровню друида, делённому на 3 (округляя вниз).'],
                    ],
                    '6' => [
                        ['key' => 'primal_strike', 'name' => 'Первобытный удар', 'description' => 'Ваши атаки в диком облике считаются магическими для целей преодоления сопротивления и иммунитета к немагическим атакам и урону.'],
                    ],
                    '10' => [
                        ['key' => 'elemental_wild_shape', 'name' => 'Элементальный дикий облик', 'description' => 'Вы можете потратить два использования Дикого облика одновременно, чтобы превратиться в воздушного элементаля, водного элементаля, земляного элементаля или огненного элементаля.'],
                    ],
                    '14' => [
                        ['key' => 'thousand_forms', 'name' => 'Тысяча форм', 'description' => 'Вы можете накладывать заклинание Изменение облика по желанию, не тратя ячейку заклинаний. Заклинание не требует концентрации и может длиться неограниченно долго.'],
                    ],
                ],
            ],

            // CIRCLE OF SPORES
            [
                'slug' => 'circle-of-spores',
                'name' => ['ru' => 'Круг Спор'],
                'parent_slug' => 'druid',
                'description' => ['ru' => 'Друиды Круга Спор находят красоту в разложении, видя в нём часть великого цикла жизни. Они используют силу грибов и спор, управляя процессами гниения и перерождения.'],
                'level_features' => [
                    '2' => [
                        ['key' => 'halo_of_spores', 'name' => 'Ореол спор', 'description' => 'Вы окружены невидимыми некротическими спорами, безвредными для вас. Когда существо, которое вы видите, перемещается в пространство в пределах 3 м от вас или начинает там ход, вы можете реакцией заставить его совершить спасбросок Телосложения. При провале существо получает 1d4 некротического урона. Урон увеличивается до 1d6 на 6 уровне, 1d8 на 10 и 1d10 на 14.'],
                        ['key' => 'symbiotic_entity', 'name' => 'Симбиотическая сущность', 'description' => 'Действием вы можете потратить использование Дикого облика, чтобы пробудить споры, а не превращаться в зверя. Вы получаете 4 временных хита за каждый уровень друида. Пока временные хиты есть: урон Ореола спор удваивается, и ваши рукопашные атаки оружием наносят дополнительно 1d6 некротического урона. Эффект длится 10 минут или пока вы не используете Дикий облик.'],
                    ],
                    '6' => [
                        ['key' => 'fungal_infestation', 'name' => 'Грибное заражение', 'description' => 'Если зверь или гуманоид с ОП 1 или ниже умирает в пределах 3 м от вас, вы можете реакцией оживить его спорами. Существо немедленно поднимается с 1 хитом. Оно считается растением и действует сразу после вашего хода. Оно может совершить только действие Атака (одна рукопашная атака). После 1 часа существо умирает. Использование = модификатор Мудрости за продолжительный отдых.', 'uses' => 'wisdom_mod', 'recharge' => 'long_rest'],
                    ],
                    '10' => [
                        ['key' => 'spreading_spores', 'name' => 'Распространяющиеся споры', 'description' => 'Бонусным действием вы можете создать куб спор со стороной 3 м в точке, которую видите в пределах 9 м. Куб существует 1 минуту. Пока Симбиотическая сущность активна, вы можете использовать Ореол спор реакцией на существо, входящее в куб или начинающее там ход.'],
                    ],
                    '14' => [
                        ['key' => 'fungal_body', 'name' => 'Грибное тело', 'description' => 'Споры в вашем теле изменяют вас: вы не можете быть ослеплены, оглушены, испуганы или отравлены. Критические попадания по вам считаются обычными попаданиями, если только вы не недееспособны.'],
                    ],
                ],
            ],

            // CIRCLE OF STARS
            [
                'slug' => 'circle-of-stars',
                'name' => ['ru' => 'Круг Звёзд'],
                'parent_slug' => 'druid',
                'description' => ['ru' => 'Друиды Круга Звёзд черпают силу из древних звёздных карт и созвездий. Они изучают небесные тела и используют их энергию для усиления своей магии.'],
                'level_features' => [
                    '2' => [
                        ['key' => 'star_map', 'name' => 'Звёздная карта', 'description' => 'Вы создаёте звёздную карту — крошечный предмет, который служит фокусом для заклинаний друида. Пока карта при вас, вы знаете заговор Руководство и можете сотворить его как бонусное действие. Вы можете сотворить Направленный снаряд без траты ячейки заклинаний число раз, равное бонусу мастерства. Восстанавливается после продолжительного отдыха.'],
                        ['key' => 'starry_form', 'name' => 'Звёздная форма', 'description' => 'Бонусным действием вы можете потратить использование Дикого облика, чтобы принять звёздную форму на 10 минут. Ваше тело становится светящимся. Выберите созвездие: Лучник (при попадании атакой заклинанием добавьте 1d8 сияющего урона), Чаша (при заклинании 1+ уровня, исцеляющем хиты, восстановите дополнительно 1d8 + МДР), или Дракон (минимум 10 на проверках концентрации, скорость полёта парения = скорость ходьбы).'],
                    ],
                    '6' => [
                        ['key' => 'cosmic_omen', 'name' => 'Космическое предзнаменование', 'description' => 'После продолжительного отдыха бросьте d6. Чётный результат — Горе: реакцией, когда существо в пределах 9 м совершает бросок атаки, спасбросок или проверку характеристики, вы можете вычесть 1d6 из броска. Нечётный результат — Радость: вместо вычитания добавить 1d6. Использование = бонус мастерства за продолжительный отдых.', 'uses' => 'proficiency', 'recharge' => 'long_rest'],
                    ],
                    '10' => [
                        ['key' => 'twinkling_constellations', 'name' => 'Мерцающие созвездия', 'description' => 'Кости созвездия становятся 2d8. В начале каждого своего хода в звёздной форме вы можете сменить активное созвездие.'],
                    ],
                    '14' => [
                        ['key' => 'full_of_stars', 'name' => 'Полный звёзд', 'description' => 'В звёздной форме вы становитесь частично бестелесным. Вы получаете сопротивление дробящему, колющему и рубящему урону.'],
                    ],
                ],
            ],

            // CIRCLE OF THE SHEPHERD
            [
                'slug' => 'circle-of-the-shepherd',
                'name' => ['ru' => 'Круг Пастыря'],
                'parent_slug' => 'druid',
                'description' => ['ru' => 'Друиды Круга Пастыря общаются с духами природы, особенно с духами зверей и фей. Они призывают духов-тотемов, которые защищают и усиливают их союзников.'],
                'level_features' => [
                    '2' => [
                        ['key' => 'speech_of_the_woods', 'name' => 'Речь леса', 'description' => 'Вы получаете способность говорить, читать и писать на Сильване. Звери понимают вашу речь, и вы получаете преимущество на все проверки Харизмы при взаимодействии с ними.'],
                        ['key' => 'spirit_totem', 'name' => 'Дух-тотем', 'description' => 'Бонусным действием вы можете призвать бестелесного духа в точку в пределах 18 м от вас на 1 минуту. Аура радиусом 9 м. Медведь: вы и союзники получаете временные хиты (5 + уровень друида) при входе в ауру. Ястреб: преимущество на атаки по врагам в ауре. Единорог: преимущество на проверки для обнаружения существ; при исцелении заклинанием в ауре восстановите доп. хиты = уровень друида. Бесплатно раз за отдых, далее за ячейку заклинаний.'],
                    ],
                    '6' => [
                        ['key' => 'mighty_summoner', 'name' => 'Могучий призыватель', 'description' => 'Звери и феи, призванные вашими заклинаниями друида, получают +2 хита за каждую Кость Хитов и их естественное оружие считается магическим для преодоления сопротивления и иммунитета.'],
                    ],
                    '10' => [
                        ['key' => 'guardian_spirit', 'name' => 'Дух-хранитель', 'description' => 'Когда зверь или фея, призванный вами или созданный заклинанием, находится в ауре вашего Духа-тотема и восстанавливает хиты, он восстанавливает дополнительно число хитов, равное половине вашего уровня друида.'],
                    ],
                    '14' => [
                        ['key' => 'faithful_summons', 'name' => 'Верные призывы', 'description' => 'Когда вы опускаетесь до 0 хитов или становитесь недееспособны, вы можете немедленно получить эффект заклинания Призыв зверей 9 уровня (не требует концентрации). 4 зверя с ОП 2 или ниже появляются в пределах 6 м от вас и охраняют вас, атакуя ближайших врагов. Через 1 час они исчезают. Раз за продолжительный отдых.', 'uses_per_rest' => 1, 'recharge' => 'long_rest'],
                    ],
                ],
            ],

            // CIRCLE OF DREAMS
            [
                'slug' => 'circle-of-dreams',
                'name' => ['ru' => 'Круг Снов'],
                'parent_slug' => 'druid',
                'description' => ['ru' => 'Друиды Круга Снов имеют связь со Страной Фей и благословлены силами, дарованными духами этого царства. Их магия исцеляет и защищает усталых и слабых.'],
                'level_features' => [
                    '2' => [
                        ['key' => 'balm_of_the_summer_court', 'name' => 'Бальзам Летнего двора', 'description' => 'У вас есть запас целительной энергии фей в виде пула d6, равного 5 × уровень друида. Бонусным действием выберите существо, которое видите в пределах 36 м, и потратьте кости (максимум = половина уровня друида). Существо восстанавливает хиты (бросок кубов) и получает 1 временный хит за каждую потраченную кость. Пул восстанавливается после продолжительного отдыха.', 'recharge' => 'long_rest'],
                    ],
                    '6' => [
                        ['key' => 'hearth_of_moonlight_and_shadow', 'name' => 'Очаг лунного света и тени', 'description' => 'В начале короткого или продолжительного отдыха вы можете создать невидимую сферу радиусом 9 м. Сфера существует до конца отдыха или пока вы не покинете её. Вы и союзники внутри сферы получают +5 к проверкам Ловкости (Скрытность) и Мудрости (Внимательность), и свет от открытого огня внутри сферы не виден снаружи.'],
                    ],
                    '10' => [
                        ['key' => 'hidden_paths', 'name' => 'Скрытые тропы', 'description' => 'Бонусным действием вы можете телепортироваться на 18 м в видимую незанятую точку. Альтернативно, вы можете коснуться согласного существа и телепортировать его на 9 м в видимую незанятую точку. Использование = бонус мастерства за продолжительный отдых.', 'uses' => 'proficiency', 'recharge' => 'long_rest'],
                    ],
                    '14' => [
                        ['key' => 'walker_in_dreams', 'name' => 'Странник снов', 'description' => 'После короткого отдыха вы можете сотворить одно из следующих заклинаний без траты ячейки и материальных компонентов: Сон, Наблюдение или Телепортационный круг (связывает вас только с последним местом, где вы закончили продолжительный отдых). Раз за продолжительный отдых.', 'uses_per_rest' => 1, 'recharge' => 'long_rest'],
                    ],
                ],
            ],

            // CIRCLE OF WILDFIRE
            [
                'slug' => 'circle-of-wildfire',
                'name' => ['ru' => 'Круг Дикого Огня'],
                'parent_slug' => 'druid',
                'description' => ['ru' => 'Друиды Круга Дикого Огня понимают, что разрушение иногда предшествует созиданию. Они призывают огненных духов для уничтожения врагов и исцеления союзников через очищающее пламя.'],
                'level_features' => [
                    '2' => [
                        ['key' => 'summon_wildfire_spirit', 'name' => 'Призыв духа дикого огня', 'description' => 'Действием вы можете потратить использование Дикого облика, чтобы призвать духа дикого огня (а не превращаться в зверя). Дух появляется в незанятом пространстве в пределах 9 м. Каждое существо в пределах 3 м от точки появления (кроме вас) совершает спасбросок Ловкости против СЛ ваших заклинаний. При провале получает 2d6 огненного урона. Дух дружелюбен и подчиняется вашим командам. Он действует сразу после вас.'],
                    ],
                    '6' => [
                        ['key' => 'enhanced_bond', 'name' => 'Усиленная связь', 'description' => 'Связь с духом дикого огня усиливает вашу магию. Когда вы творите заклинание, наносящее огненный урон или восстанавливающее хиты (пока дух призван), бросьте d8 и добавьте результат к одному броску урона или исцеления заклинания. Кроме того, когда вы творите заклинание с дальностью не «На себя», оно может исходить от вас или от духа.'],
                    ],
                    '10' => [
                        ['key' => 'cauterizing_flames', 'name' => 'Прижигающее пламя', 'description' => 'Когда Маленькое или большее существо умирает в пределах 9 м от вас или духа, вы можете реакцией заставить призрачное пламя появиться в его пространстве. Пламя существует 1 минуту. Когда существо входит в пространство пламени впервые за ход или начинает там ход, вы можете восстановить ему 2d10+МДР хитов или нанести 2d10+МДР огненного урона. Использование = бонус мастерства за продолжительный отдых.', 'uses' => 'proficiency', 'recharge' => 'long_rest'],
                    ],
                    '14' => [
                        ['key' => 'blazing_revival', 'name' => 'Пылающее возрождение', 'description' => 'Если дух дикого огня находится в пределах 36 м от вас, когда вы падаете до 0 хитов и не убиты сразу, вы можете заставить духа погибнуть, и вы восстанавливаете хиты, равные половине максимума хитов. После чего вы поднимаетесь на ноги. Раз за продолжительный отдых.', 'uses_per_rest' => 1, 'recharge' => 'long_rest'],
                    ],
                ],
            ],
        ];
    }
}
