<?php

namespace Database\Seeders;

use App\Models\CharacterClass;
use App\Models\Setting;
use Illuminate\Database\Seeder;

class RogueClassSeeder extends Seeder
{
    public function run(): void
    {
        $eberron = Setting::where('slug', 'eberron')->first();
        $forgottenRealms = Setting::where('slug', 'forgotten-realms')->first();

        // Update base rogue class with complete data
        $rogue = CharacterClass::updateOrCreate(
            ['slug' => 'rogue'],
            $this->getRogueClass()
        );

        // Attach to settings
        if ($eberron) {
            $rogue->settings()->syncWithoutDetaching([$eberron->id]);
        }
        if ($forgottenRealms) {
            $rogue->settings()->syncWithoutDetaching([$forgottenRealms->id]);
        }

        // Seed subclasses
        $subclasses = $this->getSubclasses();
        foreach ($subclasses as $data) {
            $isSpellcaster = isset($data['is_spellcaster']) && $data['is_spellcaster'];

            $subclass = CharacterClass::updateOrCreate(
                ['slug' => $data['slug']],
                array_merge($data, [
                    'hit_die' => 'd8',
                    'is_system' => true,
                ])
            );

            if ($eberron) {
                $subclass->settings()->syncWithoutDetaching([$eberron->id]);
            }
            if ($forgottenRealms) {
                $subclass->settings()->syncWithoutDetaching([$forgottenRealms->id]);
            }
        }

        $this->command->info('Rogue class seeded: base class + ' . count($subclasses) . ' subclasses');
    }

    private function getRogueClass(): array
    {
        return [
            'slug' => 'rogue',
            'name' => ['ru' => 'Плут'],
            'description' => ['ru' => 'Мошенник, использующий скрытность и хитрость для преодоления препятствий и врагов. Плуты полагаются на умения, а не грубую силу, предпочитая один точный удар серии атак.'],
            'hit_die' => 'd8',
            'primary_abilities' => ['dexterity'],
            'saving_throws' => ['dexterity', 'intelligence'],
            'armor_proficiencies' => ['light'],
            'weapon_proficiencies' => ['simple', 'hand_crossbow', 'longsword', 'rapier', 'shortsword'],
            'tool_proficiencies' => ['thieves_tools'],
            'skill_choices' => 4,
            'skill_options' => ['acrobatics', 'athletics', 'deception', 'insight', 'intimidation', 'investigation', 'perception', 'performance', 'persuasion', 'sleight_of_hand', 'stealth'],
            'starting_equipment' => [
                ['choice' => true, 'options' => [
                    [['item' => 'rapier', 'qty' => 1]],
                    [['item' => 'shortsword', 'qty' => 1]],
                ]],
                ['choice' => true, 'options' => [
                    [['item' => 'shortbow', 'qty' => 1], ['item' => 'arrows', 'qty' => 20]],
                    [['item' => 'shortsword', 'qty' => 1]],
                ]],
                ['choice' => true, 'options' => [
                    [['item' => 'burglar_pack', 'qty' => 1]],
                    [['item' => 'dungeoneer_pack', 'qty' => 1]],
                    [['item' => 'explorer_pack', 'qty' => 1]],
                ]],
                ['item' => 'leather_armor', 'qty' => 1],
                ['item' => 'dagger', 'qty' => 2],
                ['item' => 'thieves_tools', 'qty' => 1],
            ],
            'starting_gold_formula' => '4d4 * 10',
            'level_features' => [
                '1' => [
                    ['key' => 'expertise', 'name' => 'Экспертиза', 'description' => 'Выберите два навыка, которыми владеете, или один навык и воровские инструменты. Ваш бонус мастерства удваивается для этих навыков.', 'type' => 'feature'],
                    ['key' => 'sneak_attack', 'name' => 'Скрытая атака', 'description' => 'Раз в ход вы можете нанести дополнительный урон 1d6 существу, по которому попали атакой, если у вас есть преимущество на бросок атаки. Атака должна быть совершена оружием дальнего боя или оружием со свойством «фехтовальное». Вы не должны иметь помеху для атаки. Вам не нужно преимущество, если другой враг цели находится в пределах 1,5 метра от неё.', 'type' => 'feature'],
                    ['key' => 'thieves_cant', 'name' => 'Воровской жаргон', 'description' => 'Вы выучили воровской жаргон — тайный набор диалектов, жестов и кодов, позволяющий скрывать сообщения в обычном разговоре. Только тот, кто знает жаргон, понимает скрытый смысл.', 'type' => 'feature'],
                ],
                '2' => [
                    ['key' => 'cunning_action', 'name' => 'Хитрое действие', 'description' => 'Вы можете бонусным действием совершить Рывок, Отход или Засаду в каждом своём ходу в бою.', 'type' => 'feature'],
                ],
                '3' => [
                    ['key' => 'roguish_archetype', 'name' => 'Архетип плута', 'description' => 'Выберите архетип, воплощающий ваши плутовские способности.', 'type' => 'subclass'],
                ],
                '4' => [
                    ['key' => 'ability_score_improvement', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                ],
                '5' => [
                    ['key' => 'uncanny_dodge', 'name' => 'Невероятное уклонение', 'description' => 'Когда атакующий, которого вы видите, попадает по вам атакой, вы можете реакцией уменьшить урон от этой атаки вдвое.', 'type' => 'feature'],
                ],
                '6' => [
                    ['key' => 'expertise_6', 'name' => 'Экспертиза', 'description' => 'Выберите ещё два навыка, которыми владеете. Ваш бонус мастерства удваивается для этих навыков.', 'type' => 'feature'],
                ],
                '7' => [
                    ['key' => 'evasion', 'name' => 'Уклонение', 'description' => 'Когда вы подвергаетесь эффекту, требующему спасброска Ловкости для получения половины урона, вы не получаете урон при успехе и получаете только половину при провале.', 'type' => 'feature'],
                ],
                '8' => [
                    ['key' => 'ability_score_improvement_8', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                ],
                '10' => [
                    ['key' => 'ability_score_improvement_10', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                ],
                '11' => [
                    ['key' => 'reliable_talent', 'name' => 'Надёжный талант', 'description' => 'При любой проверке характеристики, к которой вы добавляете бонус мастерства, результат броска 9 или меньше считается как 10.', 'type' => 'feature'],
                ],
                '12' => [
                    ['key' => 'ability_score_improvement_12', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                ],
                '14' => [
                    ['key' => 'blindsense', 'name' => 'Слепое чутьё', 'description' => 'Если вы можете слышать, вы знаете местонахождение любого невидимого или скрытого существа в пределах 3 метров от вас.', 'type' => 'feature'],
                ],
                '15' => [
                    ['key' => 'slippery_mind', 'name' => 'Скользкий ум', 'description' => 'Вы получаете владение спасбросками Мудрости.', 'type' => 'feature'],
                ],
                '16' => [
                    ['key' => 'ability_score_improvement_16', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                ],
                '18' => [
                    ['key' => 'elusive', 'name' => 'Неуловимость', 'description' => 'Вы настолько ловки, что атакующие редко одерживают над вами верх. Никакой бросок атаки не может иметь преимущество против вас, пока вы не недееспособны.', 'type' => 'feature'],
                ],
                '19' => [
                    ['key' => 'ability_score_improvement_19', 'name' => 'Увеличение характеристик', 'description' => 'Увеличьте одну характеристику на 2 или две характеристики на 1, или возьмите черту.', 'type' => 'asi'],
                ],
                '20' => [
                    ['key' => 'stroke_of_luck', 'name' => 'Удача', 'description' => 'Если ваша атака промахивается по цели в пределах дистанции, вы можете превратить промах в попадание. Или если вы проваливаете проверку характеристики, вы можете считать результат броска d20 равным 20. Использовав эту способность, вы не можете использовать её снова до окончания короткого или продолжительного отдыха.', 'type' => 'feature', 'uses_per_rest' => 1, 'recharge' => 'short_rest'],
                ],
            ],
            'progression' => [
                '1' => ['proficiency_bonus' => 2, 'sneak_attack' => '1d6'],
                '2' => ['proficiency_bonus' => 2, 'sneak_attack' => '1d6'],
                '3' => ['proficiency_bonus' => 2, 'sneak_attack' => '2d6'],
                '4' => ['proficiency_bonus' => 2, 'sneak_attack' => '2d6'],
                '5' => ['proficiency_bonus' => 3, 'sneak_attack' => '3d6'],
                '6' => ['proficiency_bonus' => 3, 'sneak_attack' => '3d6'],
                '7' => ['proficiency_bonus' => 3, 'sneak_attack' => '4d6'],
                '8' => ['proficiency_bonus' => 3, 'sneak_attack' => '4d6'],
                '9' => ['proficiency_bonus' => 4, 'sneak_attack' => '5d6'],
                '10' => ['proficiency_bonus' => 4, 'sneak_attack' => '5d6'],
                '11' => ['proficiency_bonus' => 4, 'sneak_attack' => '6d6'],
                '12' => ['proficiency_bonus' => 4, 'sneak_attack' => '6d6'],
                '13' => ['proficiency_bonus' => 5, 'sneak_attack' => '7d6'],
                '14' => ['proficiency_bonus' => 5, 'sneak_attack' => '7d6'],
                '15' => ['proficiency_bonus' => 5, 'sneak_attack' => '8d6'],
                '16' => ['proficiency_bonus' => 5, 'sneak_attack' => '8d6'],
                '17' => ['proficiency_bonus' => 6, 'sneak_attack' => '9d6'],
                '18' => ['proficiency_bonus' => 6, 'sneak_attack' => '9d6'],
                '19' => ['proficiency_bonus' => 6, 'sneak_attack' => '10d6'],
                '20' => ['proficiency_bonus' => 6, 'sneak_attack' => '10d6'],
            ],
            'is_spellcaster' => false,
            'subclass_level' => '3',
            'subclass_name' => ['ru' => 'Архетип плута'],
            'is_system' => true,
            'sort_order' => 9,
        ];
    }

    private function getSubclasses(): array
    {
        return [
            // THIEF
            [
                'slug' => 'thief',
                'name' => ['ru' => 'Вор'],
                'parent_slug' => 'rogue',
                'description' => ['ru' => 'Вы оттачиваете навыки воровского искусства. Взломщики, бандиты, карманники и прочие преступники обычно следуют этому архетипу, но он также подходит тем плутам, которые предпочитают думать о себе как о профессиональных искателях сокровищ.'],
                'is_spellcaster' => false,
                'level_features' => [
                    '3' => [
                        ['key' => 'fast_hands', 'name' => 'Быстрые руки', 'description' => 'Вы можете бонусным действием от Хитрого действия совершить проверку Ловкости (Ловкость рук), использовать воровские инструменты для обезвреживания ловушки или вскрытия замка, или совершить действие Использование предмета.'],
                        ['key' => 'second_story_work', 'name' => 'Работа на высоте', 'description' => 'Вы получаете возможность лазать быстрее обычного: лазанье больше не стоит вам дополнительного перемещения. Кроме того, дистанция вашего прыжка с разбега увеличивается на число футов, равное вашему модификатору Ловкости.'],
                    ],
                    '9' => [
                        ['key' => 'supreme_sneak', 'name' => 'Превосходная скрытность', 'description' => 'Вы получаете преимущество на проверки Ловкости (Скрытность), если в этом ходу перемещаетесь не более чем на половину своей скорости.'],
                    ],
                    '13' => [
                        ['key' => 'use_magic_device', 'name' => 'Использование магических устройств', 'description' => 'Вы достаточно изучили работу магии, чтобы импровизировать при использовании предметов, даже если они не предназначены для вас. Вы игнорируете все требования класса, расы и уровня при использовании магических предметов.'],
                    ],
                    '17' => [
                        ['key' => 'thiefs_reflexes', 'name' => 'Рефлексы вора', 'description' => 'Вы можете совершить два хода в первом раунде каждого боя. Первый ход вы совершаете в обычном порядке инициативы, а второй — с инициативой минус 10. Вы не можете использовать эту способность, если вы застигнуты врасплох.'],
                    ],
                ],
            ],

            // ASSASSIN
            [
                'slug' => 'assassin',
                'name' => ['ru' => 'Убийца'],
                'parent_slug' => 'rogue',
                'description' => ['ru' => 'Вы сосредоточили свои тренировки на мрачном искусстве смерти. Те, кто предаётся этому архетипу, — наёмные убийцы, шпионы, охотники за головами и даже специально обученные священники, чтобы истреблять врагов своего божества.'],
                'is_spellcaster' => false,
                'level_features' => [
                    '3' => [
                        ['key' => 'bonus_proficiencies_assassin', 'name' => 'Дополнительное владение', 'description' => 'Вы получаете владение набором для грима и набором отравителя.'],
                        ['key' => 'assassinate', 'name' => 'Убийство', 'description' => 'Вы получаете преимущество на броски атаки против любого существа, ещё не совершавшего ход в этом бою. Кроме того, любое попадание по застигнутому врасплох существу является критическим.'],
                    ],
                    '9' => [
                        ['key' => 'infiltration_expertise', 'name' => 'Эксперт по проникновению', 'description' => 'Вы можете безошибочно создавать ложные личности для себя. Потратив семь дней и 25 зм, вы создаёте документы, устанавливаете знакомства и продумываете историю, чтобы выдавать себя за конкретную личность.'],
                    ],
                    '13' => [
                        ['key' => 'impostor', 'name' => 'Самозванец', 'description' => 'Вы можете безошибочно копировать речь, письмо и поведение другого человека. Вы должны потратить не менее трёх часов на изучение этих трёх компонентов поведения существа.'],
                    ],
                    '17' => [
                        ['key' => 'death_strike', 'name' => 'Смертельный удар', 'description' => 'Когда вы атакуете и попадаете по застигнутому врасплох существу, оно должно совершить спасбросок Телосложения (СЛ 8 + ваш модификатор Ловкости + бонус мастерства). При провале урон от атаки удваивается.'],
                    ],
                ],
            ],

            // ARCANE TRICKSTER
            [
                'slug' => 'arcane-trickster',
                'name' => ['ru' => 'Мистический ловкач'],
                'parent_slug' => 'rogue',
                'description' => ['ru' => 'Некоторые плуты усиливают свои отточенные навыки скрытности и ловкости магией, изучая заклинания Очарования и Иллюзии. Эти плуты включают карманников и взломщиков, но также и шутников, смутьянов и значительное число авантюристов.'],
                'is_spellcaster' => true,
                'spellcasting_ability' => 'intelligence',
                'spell_slots' => [
                    '3' => ['1st' => 2],
                    '4' => ['1st' => 3],
                    '5' => ['1st' => 3],
                    '6' => ['1st' => 3],
                    '7' => ['1st' => 4, '2nd' => 2],
                    '8' => ['1st' => 4, '2nd' => 2],
                    '9' => ['1st' => 4, '2nd' => 2],
                    '10' => ['1st' => 4, '2nd' => 3],
                    '11' => ['1st' => 4, '2nd' => 3],
                    '12' => ['1st' => 4, '2nd' => 3],
                    '13' => ['1st' => 4, '2nd' => 3, '3rd' => 2],
                    '14' => ['1st' => 4, '2nd' => 3, '3rd' => 2],
                    '15' => ['1st' => 4, '2nd' => 3, '3rd' => 2],
                    '16' => ['1st' => 4, '2nd' => 3, '3rd' => 3],
                    '17' => ['1st' => 4, '2nd' => 3, '3rd' => 3],
                    '18' => ['1st' => 4, '2nd' => 3, '3rd' => 3],
                    '19' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 1],
                    '20' => ['1st' => 4, '2nd' => 3, '3rd' => 3, '4th' => 1],
                ],
                'spells_known' => ['3' => 3, '4' => 4, '7' => 5, '8' => 6, '10' => 7, '11' => 8, '13' => 9, '14' => 10, '16' => 11, '19' => 12, '20' => 13],
                'level_features' => [
                    '3' => [
                        ['key' => 'spellcasting_at', 'name' => 'Использование заклинаний', 'description' => 'Вы изучаете заклинания из списка волшебника, сосредотачиваясь на школах Очарования и Иллюзии. Интеллект — ваша базовая характеристика для заклинаний. Вы знаете три заговора (включая Волшебную руку) и три заклинания 1 уровня.', 'type' => 'spellcasting'],
                        ['key' => 'mage_hand_legerdemain', 'name' => 'Ловкость волшебной руки', 'description' => 'Когда вы накладываете Волшебную руку, вы можете сделать руку невидимой. Бонусным действием вы можете управлять рукой для: прятания предмета на существе, доставания предмета из контейнера, или использования воровских инструментов для обезвреживания ловушки/вскрытия замка на расстоянии.'],
                    ],
                    '9' => [
                        ['key' => 'magical_ambush', 'name' => 'Магическая засада', 'description' => 'Если вы скрыты от существа, когда накладываете на него заклинание, это существо совершает спасбросок против заклинания с помехой.'],
                    ],
                    '13' => [
                        ['key' => 'versatile_trickster', 'name' => 'Многогранный ловкач', 'description' => 'Вы можете бонусным действием управлять Волшебной рукой, чтобы отвлечь существо в пределах 1,5 м от руки. Вы получаете преимущество на броски атаки против этого существа до конца хода.'],
                    ],
                    '17' => [
                        ['key' => 'spell_thief', 'name' => 'Похититель заклинаний', 'description' => 'Когда существо накладывает заклинание, нацеленное на вас или включающее вас в область воздействия, вы можете реакцией заставить существо совершить спасбросок характеристики заклинателя против вашей СЛ заклинаний. При провале вы отменяете эффект заклинания для себя и крадёте знание заклинания (если оно 1-4 уровня и есть ячейка). Вы можете наложить его в течение следующих 8 часов. Использование восстанавливается после продолжительного отдыха.', 'uses_per_rest' => 1, 'recharge' => 'long_rest'],
                    ],
                ],
            ],

            // SWASHBUCKLER
            [
                'slug' => 'swashbuckler',
                'name' => ['ru' => 'Фехтовальщик'],
                'parent_slug' => 'rogue',
                'description' => ['ru' => 'Вы сосредоточились на искусстве клинка, полагаясь на скорость, элегантность и обаяние в равной мере. Фехтовальщики процветают в одиночных дуэлях и могут сражаться с двумя руками, сохраняя при этом изящество и остроумие.'],
                'is_spellcaster' => false,
                'level_features' => [
                    '3' => [
                        ['key' => 'fancy_footwork', 'name' => 'Изящные маневры', 'description' => 'Во время своего хода, если вы совершили рукопашную атаку против существа, это существо не может совершать провоцированные атаки по вам до конца этого хода.'],
                        ['key' => 'rakish_audacity', 'name' => 'Бравада', 'description' => 'Вы можете добавить модификатор Харизмы к проверкам инициативы. Кроме того, вам не нужно преимущество на бросок атаки для Скрытой атаки, если в пределах 1,5 м от вас нет других существ кроме цели. Все остальные условия Скрытой атаки применяются.'],
                    ],
                    '9' => [
                        ['key' => 'panache', 'name' => 'Апломб', 'description' => 'Действием вы соревнуетесь вашей проверкой Харизмы (Убеждение) против проверки Мудрости (Проницательность) существа. Если существо враждебно и вы преуспели, оно имеет помеху на атаки по целям, отличным от вас, и не может совершать провоцированные атаки по другим целям. Если существо не враждебно и вы преуспели, оно очаровано вами на 1 минуту.'],
                    ],
                    '13' => [
                        ['key' => 'elegant_maneuver', 'name' => 'Элегантный манёвр', 'description' => 'Бонусным действием вы получаете преимущество на следующую проверку Ловкости (Акробатика) или Силы (Атлетика) в этом ходу.'],
                    ],
                    '17' => [
                        ['key' => 'master_duelist', 'name' => 'Мастер дуэли', 'description' => 'Если вы промахиваетесь броском атаки, вы можете перебросить его с преимуществом. Использовав эту способность, вы не можете использовать её снова до окончания короткого или продолжительного отдыха.', 'uses_per_rest' => 1, 'recharge' => 'short_rest'],
                    ],
                ],
            ],

            // MASTERMIND
            [
                'slug' => 'mastermind',
                'name' => ['ru' => 'Интриган'],
                'parent_slug' => 'rogue',
                'description' => ['ru' => 'Ваша цель — люди и влияние, которое они оказывают. Многие шпионы, придворные и заговорщики следуют этому архетипу, ведя жизнь в интригах. Слова — ваше оружие так же часто, как нож или яд.'],
                'is_spellcaster' => false,
                'level_features' => [
                    '3' => [
                        ['key' => 'master_of_intrigue', 'name' => 'Мастер интриг', 'description' => 'Вы получаете владение набором для грима, набором для подделок и одним игровым набором. Вы изучаете два языка на выбор. Вы можете безошибочно имитировать акцент и манеру речи существа, которое слышали минимум 1 минуту.'],
                        ['key' => 'master_of_tactics', 'name' => 'Мастер тактики', 'description' => 'Бонусным действием вы можете использовать действие Помощь, чтобы помочь союзнику атаковать существо в пределах 9 метров от вас (вместо обычных 1,5 м).'],
                    ],
                    '9' => [
                        ['key' => 'insightful_manipulator', 'name' => 'Проницательный манипулятор', 'description' => 'Если вы потратите минимум 1 минуту, наблюдая или взаимодействуя с существом, вы узнаёте, превосходит ли оно вас, равно вам или уступает вам в двух из следующих характеристик: Интеллект, Мудрость, Харизма или уровень класса.'],
                    ],
                    '13' => [
                        ['key' => 'misdirection', 'name' => 'Отвлечение внимания', 'description' => 'Когда вы являетесь целью атаки и другое существо в пределах 1,5 м от вас предоставляет вам укрытие от атаки, вы можете реакцией сделать целью атаки это существо вместо себя.'],
                    ],
                    '17' => [
                        ['key' => 'soul_of_deceit', 'name' => 'Душа обмана', 'description' => 'Ваши мысли нельзя прочитать телепатией или другими средствами, если вы этого не позволите. Вы можете предоставлять ложные мысли. Магия, определяющая ложь, всегда показывает, что вы говорите правду. Вас нельзя принудить говорить правду магией.'],
                    ],
                ],
            ],

            // INQUISITIVE
            [
                'slug' => 'inquisitive',
                'name' => ['ru' => 'Пытливый'],
                'parent_slug' => 'rogue',
                'description' => ['ru' => 'Как Пытливый, вы превосходите в раскрытии секретов и распутывании загадок. Вы полагаетесь на острый глаз для деталей, но также на отточенную способность читать слова и действия других существ.'],
                'is_spellcaster' => false,
                'level_features' => [
                    '3' => [
                        ['key' => 'ear_for_deceit', 'name' => 'Чутьё на обман', 'description' => 'Когда вы совершаете проверку Мудрости (Проницательность), чтобы определить, лжёт ли существо, рассматривайте результат 7 или ниже на d20 как 8.'],
                        ['key' => 'eye_for_detail', 'name' => 'Внимание к деталям', 'description' => 'Бонусным действием вы можете совершить проверку Мудрости (Внимательность), чтобы найти скрытое существо или предмет, или проверку Интеллекта (Расследование), чтобы обнаружить подсказки.'],
                        ['key' => 'insightful_fighting', 'name' => 'Проницательный бой', 'description' => 'Бонусным действием соревнуйтесь вашей проверкой Мудрости (Проницательность) против проверки Харизмы (Обман) цели. При успехе вы можете использовать Скрытую атаку против этой цели, даже не имея преимущества, в течение 1 минуты или пока не используете эту способность против другой цели.'],
                    ],
                    '9' => [
                        ['key' => 'steady_eye', 'name' => 'Твёрдый взгляд', 'description' => 'Вы получаете преимущество на проверки Мудрости (Внимательность) и Интеллекта (Расследование), если перемещаетесь не более чем на половину скорости в этом ходу.'],
                    ],
                    '13' => [
                        ['key' => 'unerring_eye', 'name' => 'Безошибочный взгляд', 'description' => 'Действием вы чувствуете присутствие иллюзий, оборотней не в истинной форме, и другой магии, созданной для обмана чувств в пределах 9 метров, если вы не ослеплены или оглушены. Вы понимаете, что эффект присутствует, но не его местоположение или природу. Использование = модификатор Мудрости за продолжительный отдых.', 'uses' => 'wisdom_mod', 'recharge' => 'long_rest'],
                    ],
                    '17' => [
                        ['key' => 'eye_for_weakness', 'name' => 'Видеть слабость', 'description' => 'Пока используется Проницательный бой, ваш урон Скрытой атаки против этой цели увеличивается на 3d6.'],
                    ],
                ],
            ],

            // SCOUT
            [
                'slug' => 'scout',
                'name' => ['ru' => 'Разведчик'],
                'parent_slug' => 'rogue',
                'description' => ['ru' => 'Вы искусны в скрытности и выживании вдали от городских улиц, позволяя вам разведывать впереди союзников или охотиться на дичь. Разведчики — мастера засад и быстрого отступления.'],
                'is_spellcaster' => false,
                'level_features' => [
                    '3' => [
                        ['key' => 'skirmisher', 'name' => 'Застрельщик', 'description' => 'Реакцией, когда враг оканчивает ход в пределах 1,5 м от вас, вы можете переместиться на расстояние до половины скорости. Это перемещение не провоцирует атаки.'],
                        ['key' => 'survivalist', 'name' => 'Мастер выживания', 'description' => 'Вы получаете владение Природой и Выживанием, если ещё не владеете. Ваш бонус мастерства удваивается для проверок этих навыков.'],
                    ],
                    '9' => [
                        ['key' => 'superior_mobility', 'name' => 'Превосходная мобильность', 'description' => 'Ваша скорость ходьбы увеличивается на 3 метра. Если у вас есть скорость лазанья или плавания, она также увеличивается на 3 метра.'],
                    ],
                    '13' => [
                        ['key' => 'ambush_master', 'name' => 'Мастер засад', 'description' => 'Вы получаете преимущество на проверки инициативы. Кроме того, первое существо, по которому вы попадёте в первом раунде боя, становится лёгкой мишенью: все атаки против него совершаются с преимуществом до начала вашего следующего хода.'],
                    ],
                    '17' => [
                        ['key' => 'sudden_strike', 'name' => 'Внезапный удар', 'description' => 'Если вы совершаете действие Атака, вы можете совершить ещё одну атаку бонусным действием. Эта атака может также наносить урон Скрытой атакой, если вы ещё не применяли его в этот ход, но только если атакуете другую цель.'],
                    ],
                ],
            ],

            // PHANTOM
            [
                'slug' => 'phantom',
                'name' => ['ru' => 'Фантом'],
                'parent_slug' => 'rogue',
                'description' => ['ru' => 'Многие плуты ходят по тонкой линии между жизнью и смертью, рискуя своими жизнями и забирая жизни других. Следуя этой традиции, вы открыли мистическую связь с самой смертью.'],
                'is_spellcaster' => false,
                'level_features' => [
                    '3' => [
                        ['key' => 'whispers_of_dead', 'name' => 'Шёпот мёртвых', 'description' => 'Когда вы заканчиваете короткий или продолжительный отдых, вы можете получить одно владение навыком или инструментом на выбор, которое длится до следующего отдыха.'],
                        ['key' => 'wails_from_grave', 'name' => 'Стенания из могилы', 'description' => 'Когда вы наносите урон Скрытой атакой, вы можете направить часть урона как некротический во второе существо, которое видите в пределах 9 метров. Урон равен половине костей Скрытой атаки (округляя вверх). Использование = бонус мастерства за продолжительный отдых.', 'uses' => 'proficiency', 'recharge' => 'long_rest'],
                    ],
                    '9' => [
                        ['key' => 'tokens_of_departed', 'name' => 'Знаки ушедших', 'description' => 'Когда жизнь оканчивается в пределах 9 м от вас, вы можете реакцией создать жетон души (крошечная безделушка). Вы можете иметь до бонуса мастерства жетонов одновременно. Пока жетон при вас: преимущество на спасброски от смерти и проверки Телосложения. Уничтожив жетон, вы можете задать духу вопрос или использовать Стенания бесплатно.'],
                    ],
                    '13' => [
                        ['key' => 'ghost_walk', 'name' => 'Путь призрака', 'description' => 'Бонусным действием вы принимаете призрачную форму на 10 минут. Вы получаете скорость полёта 3 м и можете проходить через существ и предметы как через труднопроходимую местность. При окончании хода внутри объекта получаете 1d10 силового урона. Использование восстанавливается после продолжительного отдыха или если уничтожите жетон души.', 'uses_per_rest' => 1, 'recharge' => 'long_rest'],
                    ],
                    '17' => [
                        ['key' => 'deaths_friend', 'name' => 'Друг смерти', 'description' => 'Стенания из могилы наносят полные кости Скрытой атаки вместо половины. Когда используете Путь призрака, вы можете потратить жетон души, чтобы стать невидимым на время действия способности.'],
                    ],
                ],
            ],

            // SOULKNIFE
            [
                'slug' => 'soulknife',
                'name' => ['ru' => 'Клинок души'],
                'parent_slug' => 'rogue',
                'description' => ['ru' => 'Большинство убийц наносят удар клинками и ядом, но вы наносите удар разумом, рассекая психику врагов психическими клинками из чистой энергии, формируемыми вашей волей.'],
                'is_spellcaster' => false,
                'level_features' => [
                    '3' => [
                        ['key' => 'psionic_power', 'name' => 'Псионическая сила', 'description' => 'У вас есть запас Костей псионической энергии (d6). Их количество равно удвоенному бонусу мастерства. Вы восстанавливаете все кости после продолжительного отдыха, или одну после короткого. Способности: Пси-усиленное мастерство (добавить кость к проверке навыка), Психический шёпот (телепатическая связь на часы = бросок кости).', 'amount' => 'proficiency*2', 'recharge' => 'long_rest'],
                        ['key' => 'psychic_blades', 'name' => 'Психические клинки', 'description' => 'Действием Атака вы можете создать психический клинок из свободной руки. Фехтовальное оружие, урон 1d6 психического + модификатор характеристики, дальность 18 м. Исчезает после попадания/промаха или в конце хода. После атаки можно бонусным действием атаковать второй рукой (урон 1d4, без модификатора).'],
                    ],
                    '9' => [
                        ['key' => 'soul_blades', 'name' => 'Клинки души', 'description' => 'Самонаведение: при промахе психическим клинком бросьте кость псионической энергии и добавьте к атаке. Психическое телепортирование: бонусным действием бросьте клинок и телепортируйтесь в его точку приземления (до 3 м × бросок кости), тратя одну кость.'],
                    ],
                    '13' => [
                        ['key' => 'psychic_veil', 'name' => 'Психическая завеса', 'description' => 'Действием вы становитесь невидимым вместе со снаряжением на 1 час или пока не отмените. Заканчивается при нанесении урона или принуждении к спасброску. Бесплатно раз за продолжительный отдых, далее за одну кость псионической энергии.', 'uses_per_rest' => 1, 'recharge' => 'long_rest'],
                    ],
                    '17' => [
                        ['key' => 'rend_mind', 'name' => 'Разрыв разума', 'description' => 'Когда вы наносите урон Скрытой атакой психическим клинком, вы можете заставить цель совершить спасбросок Мудрости (СЛ 8 + бонус мастерства + модификатор Ловкости). При провале цель ошеломлена на 1 минуту (повторные спасброски в конце хода). Бесплатно раз за продолжительный отдых, далее за три кости псионической энергии.', 'uses_per_rest' => 1, 'recharge' => 'long_rest'],
                    ],
                ],
                'progression' => [
                    '3' => ['psionic_die' => 'd6'],
                    '5' => ['psionic_die' => 'd8'],
                    '11' => ['psionic_die' => 'd10'],
                    '17' => ['psionic_die' => 'd12'],
                ],
            ],
        ];
    }
}
